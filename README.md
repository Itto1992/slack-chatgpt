# gpt-3.5-turbo on your slack
## How to use
### bot作成〜サーバー立ち上げ
1. [slack boltのチュートリアル](https://slack.dev/bolt-python/ja-jp/tutorial/getting-started)などを参考にアプリを作成する
    - この時、App Manifestから[app_manifest.yaml](./app_manifest.yaml)をコピペすれば権限の設定部分をまとめて行える
2. [.env](./.env)ファイルで必要な環境変数を設定する
3. コンテナを立ち上げる

```bash
# docker-composeを使っている場合はそちらで代用可
docker compose up
```

### ChatGPTと会話する
- 作成したbotにメンションするとChatGPTがトリガーされる
- ChatGPTのリプライはメンションに対してスレッドを作る形で行われる
- ChatGPTとの会話スレッドに投稿するとChatGPTが応答する
    - この時再度メンションする必要はない

### ChatGPTと会話する時の注意点
- 会話が長くなるとChatGPTを起動する際にエラーが発生するため、長い対話には向かない
- ChatGPTが回答を生成しているときに続けてメンションすると期待しない挙動をするため避けたほうが良い。別のスレッドを立てて会話する分にはおそらくOK

## TODO
- 会話が長くなるとコンテキストが溢れてエラーが起きるので適当にハンドリングする
    - 今は特別なメッセージ等が表示されないままエラーが起きて応答が返ってこないので少なくともカスタムメッセージを表示する必要がある
    - コンテキスト長を超えたときにボックスを表示して推論を続けるか選べるようにする？
- slack特有の表記を一般的な表記（例えばマークダウン）に変換する
    - 強調表現などが特殊になっていたはず
- ストリーミング対応する
    - web版ChatGPTのような形で投稿する
    - botの応答自体にラグがあるため、ストリーミング化したとしても遅延フリーにはできない
        - botサーバーとslackの通信速度を改善すればなんとかなるかも？
- botが回答を作成している間はユーザーに追加の問いかけをさせないようにする
    - ユーザーがbotを呼び出した後、botが回答する前に追加で質問をした場合の挙動が未定義なため
    - 追加で質問されたらその時点で走っているcompletionのリクエストをキャンセルして、追加の質問を含む形で再度リクエストを送るなどする必要あり
    - ストリーミング化しても遅延がゼロではないのでこの仕組みはあったほうがよさそう
- `SYSTEM_PROMPT` を変数化するか、slackから操作できるようにする？
